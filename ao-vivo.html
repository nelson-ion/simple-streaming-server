<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Streaming 360° HLS</title>

    <!-- A-Frame para renderizar o vídeo em uma esfera 360° -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- hls.js para reproduzir HLS em navegadores que não suportam nativamente -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #000;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <!-- Cena A-Frame ocupando a tela inteira -->
    <a-scene embedded>
        <a-assets>
            <video id="video360"
                   autoplay
                   muted
                   playsinline
                   webkit-playsinline
                   crossorigin="anonymous">
            </video>
        </a-assets>

        <!-- Esfera de vídeo 360° (equiretangular) -->
        <!-- rotation="0 180 0" normalmente corrige a orientação (ajuste se necessário) -->
        <a-videosphere src="#video360" rotation="0 180 0"></a-videosphere>

        <!-- Câmera com controle de mouse/teclado -->
        <a-entity camera look-controls wasd-controls position="0 1.6 0"></a-entity>
    </a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const video = document.getElementById('video360');

            // Se o HTML servido pelo MESMO nginx que o HLS, caminho relativo
            // Se streaming AO VIVO a partir de rmtp
            const src = '/hls_live/stream.m3u8';

            if (window.Hls && Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(src);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    video.play().catch(function (err) {
                        console.log('Autoplay bloqueado, clique na tela para iniciar o vídeo.', err);
                    });
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Safari costuma tocar HLS nativamente
                video.src = src;
                video.addEventListener('loadedmetadata', function () {
                    video.play().catch(function (err) {
                        console.log('Autoplay bloqueado, clique na tela para iniciar o vídeo.', err);
                    });
                });
            } else {
                alert('Este navegador não suporta HLS (nem via hls.js). Tente usar o Chrome ou Firefox recente.');
            }
        });
    </script>

</body>
</html>

